const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VideoPlayer-CJVgqXmu.js","assets/index-D758Wazr.js","assets/index-ButFoBe3.css","assets/MarkdownContent-D1uxoRyJ.js"])))=>i.map(i=>d[i]);
import{j as e,r as l,_,S as B,R as M,u as C,a as E,A as S,E as A,D as O,b as z,c as R,d as F,C as P}from"./index-D758Wazr.js";function H({title:t}){return e.jsx("h1",{className:"mb-3 text-3xl font-bold md:mb-5 md:text-4xl",children:t})}function V(t){const r=t.endsWith("Z")?t:t+"Z",a=new Date(r),c=Math.floor((new Date().getTime()-a.getTime())/1e3);if(c<60)return`قبل ${c} ثانية`;const i=Math.floor(c/60);if(i===1)return"قبل دقيقة";if(i===2)return"قبل دقيقتين";if(i>=3&&i<11)return`قبل ${i} دقائق`;if(i<60)return`قبل ${i} دقيقة`;const n=Math.floor(i/60);return n===1?"قبل ساعة":n===2?"قبل ساعتين":n>=3&&n<11?`قبل ${n} ساعات`:n<24?`قبل ${n} ساعة`:a.toLocaleString("ar-SA",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function G({time:t}){return e.jsx("p",{className:"border-2 h-full border-(--border-color)/50 bg-(--darker-bg-color) p-2 px-5 rounded-full",children:V(t)})}function J({src:t,alt:r="",className:a=""}){const s=l.useRef(null),[c,i]=l.useState(!1);return l.useEffect(()=>{const n=s.current;if(!n)return;const d=new IntersectionObserver(([b])=>{b.isIntersecting&&(n.src=t,d.disconnect())},{rootMargin:"100px"});return d.observe(n),()=>d.disconnect()},[t]),e.jsx("img",{ref:s,alt:r,onLoad:()=>i(!0),className:`${a} max-h-full rounded-xl object-contain transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`})}const W=l.lazy(()=>_(()=>import("./VideoPlayer-CJVgqXmu.js"),__vite__mapDeps([0,1,2])));function q({images:t}){const r=t[0].startsWith("video:"),a=r?t[0].split(":")[2]:null,s=r?t[0].split(":")[1]:null;return e.jsxs("div",{className:"slider w-full md:w-fit flex max-h-full min-h-[200px] md:min-w-[200px] max-w-full items-start justify-start gap-2 overflow-x-auto overflow-y-hidden rounded-2xl border-2 border-(--border-color) bg-(--darker-bg-color) p-4",children:[!r&&t.map((c,i)=>e.jsx(J,{src:c},i)),r&&e.jsx(W,{type:s,videoId:a})]})}function K(t){if(!t)return"";const r=[];return t=t.replace(/```([\s\S]*?)```/g,(a,s)=>(r.push(s),`@@CODEBLOCK${r.length-1}@@`)),t=t.replace(/!\[(.*?)\]\((.*?)\)/g,'<img src="$2" alt="$1" />'),t=t.replace(/^---$/gim,"<hr />"),t=t.replace(/^> (.*$)/gim,"<blockquote>$1</blockquote>"),t=t.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>"),t=t.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/gim,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,(a,s)=>`<code>${s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code>`),t=t.replace(/^\- (.*$)/gim,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/gim,"<ul>$1</ul>"),t=t.replace(/\[(.*?)\]\((.*?)\)/gim,'<a href="$2">$1</a>'),t=t.replace(/\n/g,"<br />"),t=t.replace(/@@CODEBLOCK(\d+)@@/g,(a,s)=>`<pre><code>${r[parseInt(s,10)].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`),t}function Z(){return e.jsx("div",{className:"spin-parent",children:e.jsx("img",{src:B,className:"spin",width:28,height:28})})}const U=l.lazy(()=>_(()=>import("./MarkdownContent-D1uxoRyJ.js"),__vite__mapDeps([3,1,2])));class Y extends M.Component{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsx("div",{className:"not-prose block w-full py-2",dir:this.props.dir,dangerouslySetInnerHTML:{__html:this.props.fallbackHTML}}):this.props.children}}function Q({body:t,dir:r}){const a=s=>e.jsx(Y,{fallbackHTML:K(s),dir:r,children:e.jsx(l.Suspense,{fallback:e.jsx(Z,{}),children:e.jsx(U,{dir:r,content:s})})});return e.jsx(e.Fragment,{children:e.jsx("div",{className:`not-prose block w-full py-2 ${r}`,children:a(t)})})}function X({goal:t}){const r=t.startsWith("✅");return e.jsx("h1",{className:`${r?"border-green-400/30 bg-green-700/70 text-green-100":"border-(--border-color)/70 bg-(--darker-bg-color)/30"} rounded-lg border-2 p-2 px-3`,children:t})}function ee({goals:t}){return e.jsx("div",{className:"flex flex-col gap-2",children:t.map((r,a)=>e.jsx(X,{goal:r},a))})}const te="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='256'%20height='256'%20viewBox='0%200%20256%20256'%3e%3cpath%20fill='%23facc15'%20d='M208%20144a15.78%2015.78%200%200%201-10.42%2014.94L146%20178l-19%2051.62a15.92%2015.92%200%200%201-29.88%200L78%20178l-51.62-19a15.92%2015.92%200%200%201%200-29.88L78%20110l19-51.62a15.92%2015.92%200%200%201%2029.88%200L146%20110l51.62%2019A15.78%2015.78%200%200%201%20208%20144m-56-96h16v16a8%208%200%200%200%2016%200V48h16a8%208%200%200%200%200-16h-16V16a8%208%200%200%200-16%200v16h-16a8%208%200%200%200%200%2016m88%2032h-8v-8a8%208%200%200%200-16%200v8h-8a8%208%200%200%200%200%2016h8v8a8%208%200%200%200%2016%200v-8h8a8%208%200%200%200%200-16'/%3e%3c/svg%3e",I="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%3e%3cpath%20fill='%23c1caf5'%20d='M16%202C8.2%202%202%208.2%202%2016s6.2%2014%2014%2014s14-6.2%2014-14S23.8%202%2016%202m5.4%2021L16%2017.6L10.6%2023L9%2021.4l5.4-5.4L9%2010.6L10.6%209l5.4%205.4L21.4%209l1.6%201.6l-5.4%205.4l5.4%205.4z'/%3e%3c/svg%3e";function re({id:t,storyid:r,post:a,handleEditPost:s,setShowEditPost:c}){const[i,n]=l.useState(a?.title??""),[d,b]=l.useState(a?.body??""),[u,g]=l.useState(a?.images??null),[h,w]=l.useState(a?.special??!1),[m,y]=l.useState(a?.secret??!1),[o,f]=l.useState(a?.dir??"rtl"),[p,v]=l.useState(!1),{token:N}=C(),{type:x}=E();async function $(j){j.preventDefault();const k={id:t,title:i,body:d,images:u,storyid:r,type:x??"week",special:h,secret:m,dir:o};try{v(!0),(await fetch(`${S}/posts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",authorization:`Bearer ${N}`},body:JSON.stringify({...k})})).ok?(n(""),b(""),s(k),c(!1)):alert("Failed to edit post.")}catch(L){console.error(L),alert("Server error.")}finally{v(!1)}}return e.jsxs("div",{className:"flex edit-post flex-col overflow-y-auto z-900 md:flex-row md:justify-center pt-10 bg-(--darker-bg-color) gap-5 fixed top-0 left-0 h-dvh w-full",children:[e.jsxs("form",{onSubmit:$,className:"flex relative min-w-[350px] min-h-fit overflow-y-auto pt-15 border border-(--border-color) h-fit bg-(--bg-color) flex-col gap-4 p-5",children:[e.jsx("button",{className:"absolute top-4 right-4 cursor-pointer hover:brightness-110 transition",onClick:()=>c(!1),children:e.jsx("img",{src:I,width:25,height:25})}),e.jsx("input",{type:"text",value:i,onChange:j=>n(j.target.value),placeholder:"العنوان",className:"p-2 rounded border border-(--border-color)",disabled:p}),e.jsxs("select",{value:o,className:"p-2 rounded border border-(--border-color)",onChange:j=>f(j.target.value),children:[e.jsx("option",{className:"bg-(--darker-bg-color)",value:"rtl",children:"Arabic"}),e.jsx("option",{className:"bg-(--darker-bg-color)",value:"ltr",children:"English"})]}),e.jsx("textarea",{dir:o,value:d,onChange:j=>b(j.target.value),placeholder:"المحتوى",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:p}),e.jsx("textarea",{dir:"ltr",value:u&&u.length>0?u.join(", "):"",onChange:j=>g(j.target.value.split(", ").map(k=>k)),placeholder:"Images (comma separated)",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:p}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>w(!h),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${h?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${h?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:h?"Special":"Normal"})]}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>y(!m),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${m?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${m?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:m?"Secret":"Normal"})]}),e.jsx("button",{type:"submit",className:`bg-(--accent-color) font-bold p-2 rounded hover:brightness-95 text-black cursor-pointer transition ${p?"opacity-50 cursor-not-allowed":""}`,disabled:p,children:p?"جار الحفظ..":"حفظ"})]}),e.jsx(T,{title:i,body:d,dir:o,storyid:r,images:u||[],type:x||"",special:h,secret:m,isEditting:!0,handleDeletePost:()=>{}})]})}function T({title:t,id:r,time:a,images:s,body:c,dir:i,type:n,special:d,secret:b,storyid:u,isEditting:g=!1,isCreating:h=!1,handleEditPost:w,handleDeletePost:m}){const[y,o]=l.useState(!1),{isAdmin:f,token:p}=C();async function v(N){if(!confirm("Delete post?"))return;(await fetch(`${S}/posts/${N}`,{method:"DELETE",headers:{authorization:`Bearer ${p}`,"Content-Type":"application/json"}})).ok&&(m(N),alert("Deleted!"))}return e.jsxs("div",{className:`${d?"text-yellow-200":""} 
       ${b?"text-fuchsia-200":""} 
       flex post relative px-3 flex-col items-start 
       justify-start gap-4 w-full 
       md:max-w-4xl border-b-2 
       border-(--border-color) py-5 pt-10`,children:[f&&!g&&!h&&e.jsxs("div",{className:"absolute left-2 top-8 bg-(--darker-bg-color) rounded-full p-2 px-4 border border-(--border-color)/50 flex gap-2",children:[e.jsx("button",{className:"cursor-pointer p-2 bg-(--accent-color) text-black rounded-full hover:brightness-95 transition",onClick:()=>o(!0),children:e.jsx("img",{src:A,width:20,height:20})}),e.jsx("button",{className:"cursor-pointer p-2 bg-red-300 text-black rounded-full hover:brightness-95 transition",onClick:()=>{v(r??0)},children:e.jsx("img",{src:O,width:20,height:20})})]}),y&&f&&e.jsx(re,{id:r??0,storyid:u,post:{storyid:u,title:t,body:c,images:s,dir:i,type:n,special:d,secret:b},handleEditPost:w||(()=>{}),setShowEditPost:o}),t.trim()!==""&&e.jsx(H,{title:t}),e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[r&&r>436&&e.jsx(G,{time:a||""}),d&&e.jsx("span",{className:"bg-yellow-300/10 border-2 border-yellow-300/20 rounded-full p-2",children:e.jsx("img",{src:te,width:26})}),b&&e.jsx("span",{className:"bg-fuchsia-300/10 border-2 border-fuchsia-300/20 rounded-full p-2",children:e.jsx("img",{src:z,width:26})})]}),n==="goal"?e.jsx(ee,{goals:c.split(`
`)}):h||g||r&&r>=676?e.jsx(Q,{body:c,dir:i}):e.jsx("pre",{children:c}),s&&s.length>0&&e.jsx(q,{images:s})]})}function D({storyid:t,handleCreatePost:r,setShowCreatePost:a}){const[s,c]=l.useState(""),[i,n]=l.useState(""),[d,b]=l.useState(null),[u,g]=l.useState(!1),[h,w]=l.useState(!1),[m,y]=l.useState("rtl"),[o,f]=l.useState(!1),{token:p}=C(),{type:v}=E();async function N(x){x.preventDefault();const $={title:s,body:i,images:d,storyid:t,type:v??"week",special:u,secret:h,dir:m};try{f(!0),(await fetch(`${S}/posts`,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${p}`},body:JSON.stringify({...$})})).ok?(c(""),n(""),r($),a(!1)):alert("Failed to create post.")}catch(j){console.error(j),alert("Server error.")}finally{f(!1)}}return e.jsxs("div",{className:"flex flex-col overflow-y-auto z-999 md:flex-row md:justify-center pt-10 bg-(--darker-bg-color) gap-5 fixed inset-0 w-full",children:[e.jsxs("form",{onSubmit:N,className:"flex relative min-w-[350px] min-h-fit overflow-y-auto pt-15 border border-(--border-color) h-fit bg-(--bg-color) flex-col gap-4 p-5",children:[e.jsxs("h1",{className:"text-xl font-bold",children:["أنشئ منشور على الستوري رقم ",t]}),e.jsx("button",{className:"absolute top-4 right-4 cursor-pointer hover:brightness-110 transition",onClick:()=>a(!1),children:e.jsx("img",{src:I,width:25,height:25})}),e.jsx("input",{type:"text",value:s,onChange:x=>c(x.target.value),placeholder:"العنوان",className:"p-2 rounded border border-(--border-color)",disabled:o}),e.jsxs("select",{value:m,className:"p-2 rounded border border-(--border-color)",onChange:x=>y(x.target.value),children:[e.jsx("option",{className:"bg-(--darker-bg-color)",value:"rtl",children:"عربي"}),e.jsx("option",{className:"bg-(--darker-bg-color)",value:"ltr",children:"انجلش"})]}),e.jsx("textarea",{dir:m,value:i,onChange:x=>n(x.target.value),placeholder:"المحتوى",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:o}),e.jsx("textarea",{dir:"ltr",value:d&&d.length>0?d.join(", "):"",onChange:x=>b(x.target.value.split(", ").map($=>$)),placeholder:"Images (comma separated)",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:o}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>g(!u),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${u?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${u?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:u?"Special":"Normal"})]}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>w(!h),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${h?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${h?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:h?"Secret":"Normal"})]}),e.jsx("button",{type:"submit",className:`bg-(--accent-color) font-bold p-2 rounded hover:brightness-95 text-black cursor-pointer transition ${o?"opacity-50 cursor-not-allowed":""}`,disabled:o,children:o?"جار الإنشاء..":"أنشئ المنشور"})]}),e.jsx(T,{title:s,body:i,storyid:t,dir:m,images:d||[],type:v||"",special:u,secret:h,isCreating:!0,handleDeletePost:()=>{}})]})}const se=async(t,r)=>{const a=new Date().toLocaleTimeString(),s=new Date().toLocaleDateString(),c=navigator.platform+"";await fetch(`${S}/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitedAt:`${a} - ${s}`,os:c,url:r,username:t})})};function ae(){const{type:t,count:r}=R(),{setType:a}=E(),{isAdmin:s,user:c,token:i}=C(),[n,d]=l.useState(!1);function b(o){g(f=>f===null?[o]:[o,...f])}l.useEffect(()=>{if(!s&&t){async function o(){await se(c?.username??"guest - ",t&&r?`${t} - ${r}`:"Home")}o()}},[t,r]),l.useEffect(()=>{t&&a(t)},[t,a]);const[u,g]=l.useState(null),[h,w]=l.useState(!0),[m,y]=l.useState("");return l.useEffect(()=>{async function o(){try{w(!0),g(null);const f=await fetch(`${S}/posts?type=${t}&count=${r}`,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${i}`}});if(f.ok){const p=await f.json();g(p),w(!1),y("")}else w(!1),y("Something went wrong."),g(null)}catch{g(null),w(!1),y("Server Error")}}o()},[r]),F("/mohsaid99/favicons/"+t+".svg"),h?e.jsx("div",{className:"flex flex-1 h-dvh items-center justify-center",children:e.jsx("div",{className:"animate-spin w-7 h-7",children:e.jsx("img",{src:B,alt:"spinning animation",width:28})})}):m?e.jsxs("div",{className:"flex h-screen items-center justify-center",children:["Error: ",m]}):u&&u.length>0?e.jsxs("div",{className:"flex flex-col md:pr-16 min-h-screen items-center justify-center py-25",children:[s&&e.jsx("button",{className:"bg-(--accent-color) rounded-full flex items-center justify-center w-[60px] h-[60px]",onClick:()=>d(!n),children:n?null:e.jsx("img",{src:P,width:30})}),n&&s&&e.jsx(D,{setShowCreatePost:d,handleCreatePost:b,storyid:u[0].storyid}),u.map(o=>e.jsx(T,{storyid:o?.storyid??0,id:o?.id??0,title:o.title??"",time:o.iat??"",images:o?.images??[],body:o.body??"",dir:o.dir,type:o.type,special:o.special??!1,secret:o.secret??!1,handleEditPost:f=>g(p=>p&&p.map(v=>v.id===f.id?f:v)),handleDeletePost:f=>g(u.filter(p=>p.id!==f))},o.id))]}):e.jsxs("div",{className:"flex h-screen items-center justify-center",children:[s&&e.jsx("button",{className:"bg-(--accent-color) rounded-full flex items-center justify-center w-[60px] h-[60px]",onClick:()=>d(!n),children:n?null:e.jsx("img",{src:P,width:30})}),n&&s&&e.jsx(D,{setShowCreatePost:d,handleCreatePost:b,storyid:Number(r)})]})}export{ae as default};
