const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VideoPlayer-DPEKirlS.js","assets/index-D3XZIa4s.js","assets/index-Ci76A-Ts.css","assets/MarkdownContent-fHkjdTi1.js"])))=>i.map(i=>d[i]);
import{j as e,r as a,_ as L,R as D,u as k,A as S,a as P,E as _,D as M,S as I,b as O,c as A,d as B,C as z}from"./index-D3XZIa4s.js";function F({title:t}){return e.jsx("h1",{className:"mb-3 text-3xl font-bold md:mb-5 md:text-4xl",children:t})}function R(t){const r=t.endsWith("Z")?t:t+"Z",s=new Date(r),n=Math.floor((new Date().getTime()-s.getTime())/1e3);if(n<60)return`قبل ${n} ثانية`;const l=Math.floor(n/60);if(l<60)return`قبل ${l} دقيقة`;const u=Math.floor(l/60);return u<24?`قبل ${u} ساعة`:s.toLocaleString("ar-SA",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function H({time:t}){return e.jsx("p",{className:"border-2 h-full border-(--border-color)/50 bg-(--darker-bg-color) p-2 px-5 rounded-full",children:R(t)})}function V({src:t,alt:r="",className:s=""}){const o=a.useRef(null),[n,l]=a.useState(!1);return a.useEffect(()=>{const u=o.current;if(!u)return;const h=new IntersectionObserver(([g])=>{g.isIntersecting&&(u.src=t,h.disconnect())},{rootMargin:"100px"});return h.observe(u),()=>h.disconnect()},[t]),e.jsx("img",{ref:o,alt:r,onLoad:()=>l(!0),className:`${s} max-h-full rounded-xl object-contain transition-opacity duration-300 ${n?"opacity-100":"opacity-0"}`})}const G=a.lazy(()=>L(()=>import("./VideoPlayer-DPEKirlS.js"),__vite__mapDeps([0,1,2])));function J({images:t}){const r=t[0].startsWith("video:"),s=r?t[0].split(":")[2]:null,o=r?t[0].split(":")[1]:null;return e.jsxs("div",{className:"slider w-full md:w-fit flex max-h-full min-h-[200px] md:min-w-[200px] max-w-full items-start justify-start gap-2 overflow-x-auto overflow-y-hidden rounded-2xl border-2 border-(--border-color) bg-(--darker-bg-color) p-4",children:[!r&&t.map((n,l)=>e.jsx(V,{src:n},l)),r&&e.jsx(G,{type:o,videoId:s})]})}function W(t){if(!t)return"";const r=[];return t=t.replace(/```([\s\S]*?)```/g,(s,o)=>(r.push(o),`@@CODEBLOCK${r.length-1}@@`)),t=t.replace(/!\[(.*?)\]\((.*?)\)/g,'<img src="$2" alt="$1" />'),t=t.replace(/^---$/gim,"<hr />"),t=t.replace(/^> (.*$)/gim,"<blockquote>$1</blockquote>"),t=t.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>"),t=t.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/gim,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,(s,o)=>`<code>${o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code>`),t=t.replace(/^\- (.*$)/gim,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/gim,"<ul>$1</ul>"),t=t.replace(/\[(.*?)\]\((.*?)\)/gim,'<a href="$2">$1</a>'),t=t.replace(/\n/g,"<br />"),t=t.replace(/@@CODEBLOCK(\d+)@@/g,(s,o)=>`<pre><code>${r[parseInt(o,10)].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`),t}const q=a.lazy(()=>L(()=>import("./MarkdownContent-fHkjdTi1.js"),__vite__mapDeps([3,1,2])));class K extends D.Component{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsx("div",{className:"not-prose block w-full py-2",dir:this.props.dir,dangerouslySetInnerHTML:{__html:this.props.fallbackHTML}}):this.props.children}}function Z({body:t,dir:r,showAllText:s=!1}){const[o,n]=a.useState(t?.length<60),l=u=>e.jsx(K,{fallbackHTML:W(u),dir:r,children:e.jsx(a.Suspense,{fallback:e.jsx("p",{children:"Loading content..."}),children:e.jsx(q,{dir:r,content:u})})});return e.jsxs(e.Fragment,{children:[(o||s)&&e.jsx("div",{className:`not-prose block w-full py-2 ${r}`,children:l(t)}),!(o||s)&&e.jsx("div",{className:"py-2",children:!s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"not-prose w-full",children:l(t.slice(0,60))}),e.jsx("button",{className:"text-(--font-color)/40 hover:cursor-pointer",onClick:()=>n(!0),children:"عرض المزيد"})]})})]})}function U({goal:t}){const r=t.startsWith("✅");return e.jsx("h1",{className:`${r?"border-green-400/30 bg-green-700/70 text-green-100":"border-(--border-color)/70 bg-(--darker-bg-color)/30"} rounded-lg border-2 p-2 px-3`,children:t})}function Y({goals:t}){return e.jsx("div",{className:"flex flex-col gap-2",children:t.map((r,s)=>e.jsx(U,{goal:r},s))})}const Q="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='256'%20height='256'%20viewBox='0%200%20256%20256'%3e%3cpath%20fill='%23facc15'%20d='M208%20144a15.78%2015.78%200%200%201-10.42%2014.94L146%20178l-19%2051.62a15.92%2015.92%200%200%201-29.88%200L78%20178l-51.62-19a15.92%2015.92%200%200%201%200-29.88L78%20110l19-51.62a15.92%2015.92%200%200%201%2029.88%200L146%20110l51.62%2019A15.78%2015.78%200%200%201%20208%20144m-56-96h16v16a8%208%200%200%200%2016%200V48h16a8%208%200%200%200%200-16h-16V16a8%208%200%200%200-16%200v16h-16a8%208%200%200%200%200%2016m88%2032h-8v-8a8%208%200%200%200-16%200v8h-8a8%208%200%200%200%200%2016h8v8a8%208%200%200%200%2016%200v-8h8a8%208%200%200%200%200-16'/%3e%3c/svg%3e",T="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%3e%3cpath%20fill='%23c1caf5'%20d='M16%202C8.2%202%202%208.2%202%2016s6.2%2014%2014%2014s14-6.2%2014-14S23.8%202%2016%202m5.4%2021L16%2017.6L10.6%2023L9%2021.4l5.4-5.4L9%2010.6L10.6%209l5.4%205.4L21.4%209l1.6%201.6l-5.4%205.4l5.4%205.4z'/%3e%3c/svg%3e";function X({id:t,storyid:r,post:s,handleEditPost:o,setShowEditPost:n}){const[l,u]=a.useState(s?.title??""),[h,g]=a.useState(s?.body??""),[i,w]=a.useState(s?.images??null),[f,v]=a.useState(s?.special??!1),[p,d]=a.useState(s?.secret??!1),[c,m]=a.useState(s?.dir??"rtl"),[b,y]=a.useState(!1),{type:x}=k();async function N(j){j.preventDefault();const $={id:t,title:l,body:h,images:i,storyid:r,type:x??"week",special:f,secret:p,dir:c};try{y(!0),(await fetch(`${S}/posts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...$})})).ok?(u(""),g(""),o($),n(!1)):alert("Failed to edit post.")}catch(E){console.error(E),alert("Server error.")}finally{y(!1)}}return e.jsxs("div",{className:"flex edit-post flex-col overflow-y-auto z-900 md:flex-row md:justify-center pt-10 bg-(--darker-bg-color) gap-5 fixed top-0 left-0 h-dvh w-full",children:[e.jsxs("form",{onSubmit:N,className:"flex relative min-w-[300px] overflow-y-auto pt-15 border border-(--border-color) h-fit bg-(--bg-color) flex-col gap-4 p-5",children:[e.jsx("button",{className:"absolute top-4 right-4 cursor-pointer hover:brightness-110 transition",onClick:()=>n(!1),children:e.jsx("img",{src:T,width:25,height:25})}),e.jsx("input",{type:"text",value:l,onChange:j=>u(j.target.value),placeholder:"العنوان",className:"p-2 rounded border border-(--border-color)",disabled:b}),e.jsxs("select",{value:c,className:"p-2 rounded border border-(--border-color)",onChange:j=>m(j.target.value),children:[e.jsx("option",{className:"bg-(--darker-bg-color)",value:"rtl",children:"Arabic"}),e.jsx("option",{className:"bg-(--darker-bg-color)",value:"ltr",children:"English"})]}),e.jsx("textarea",{dir:c,value:h,onChange:j=>g(j.target.value),placeholder:"المحتوى",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:b}),e.jsx("textarea",{dir:"ltr",value:i&&i.length>0?i.join(", "):"",onChange:j=>w(j.target.value.split(", ").map($=>$)),placeholder:"Images (comma separated)",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:b}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>v(!f),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${f?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${f?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:f?"Special":"Normal"})]}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>d(!p),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${p?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${p?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:p?"Secret":"Normal"})]}),e.jsx("button",{type:"submit",className:`bg-(--accent-color) font-bold p-2 rounded hover:brightness-95 text-black cursor-pointer transition ${b?"opacity-50 cursor-not-allowed":""}`,disabled:b,children:b?"جار الحفظ..":"حفظ"})]}),e.jsx(C,{title:l,body:h,dir:c,storyid:r,images:i||[],type:x||"",special:f,secret:p,isEditting:!0,handleDeletePost:()=>{}})]})}function C({title:t,id:r,time:s,images:o,body:n,dir:l,type:u,special:h,secret:g,storyid:i,isEditting:w=!1,isCreating:f=!1,handleEditPost:v,handleDeletePost:p}){const[d,c]=a.useState(!1),{isAdmin:m}=P();async function b(y){if(!confirm("Delete post?"))return;(await fetch(`${S}/posts/${y}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(p(y),alert("Deleted!"))}return e.jsxs("div",{className:`${h?"text-yellow-200":""} 
       ${g?"text-fuchsia-200":""} 
       flex post relative px-3 flex-col items-start 
       justify-start gap-4 w-full 
       md:max-w-4xl border-b-2 
       border-(--border-color) py-5 pt-10`,children:[m&&!w&&!f&&e.jsxs("div",{className:"absolute left-2 top-8 bg-(--darker-bg-color) rounded-full p-2 px-4 border border-(--border-color)/50 flex gap-2",children:[e.jsx("button",{className:"cursor-pointer p-2 bg-(--accent-color) text-black rounded-full hover:brightness-95 transition",onClick:()=>c(!0),children:e.jsx("img",{src:_,width:20,height:20})}),e.jsx("button",{className:"cursor-pointer p-2 bg-red-300 text-black rounded-full hover:brightness-95 transition",onClick:()=>{b(r??0)},children:e.jsx("img",{src:M,width:20,height:20})})]}),d&&m&&e.jsx(X,{id:r??0,storyid:i,post:{storyid:i,title:t,body:n,images:o,dir:l,type:u,special:h,secret:g},handleEditPost:v||(()=>{}),setShowEditPost:c}),t.trim()!==""&&e.jsx(F,{title:t}),e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[r&&r>436&&e.jsx(H,{time:s||""}),h&&e.jsx("span",{className:"bg-yellow-300/10 border-2 border-yellow-300/20 rounded-full p-2",children:e.jsx("img",{src:Q,width:26})}),g&&e.jsx("span",{className:"bg-fuchsia-300/10 border-2 border-fuchsia-300/20 rounded-full p-2",children:e.jsx("img",{src:I,width:26})})]}),u==="goal"?e.jsx(Y,{goals:n.split(`
`)}):e.jsx(Z,{body:n,dir:l,showAllText:o?.length===0}),o&&o.length>0&&e.jsx(J,{images:o})]})}function ee({storyid:t,handleCreatePost:r,setShowCreatePost:s}){const[o,n]=a.useState(""),[l,u]=a.useState(""),[h,g]=a.useState(null),[i,w]=a.useState(!1),[f,v]=a.useState(!1),[p,d]=a.useState("rtl"),[c,m]=a.useState(!1),{type:b}=k();async function y(x){x.preventDefault();const N={title:o,body:l,images:h,storyid:t,type:b??"week",special:i,secret:f,dir:p};try{m(!0),(await fetch(`${S}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...N})})).ok?(n(""),u(""),r(N),s(!1)):alert("Failed to create post.")}catch(j){console.error(j),alert("Server error.")}finally{m(!1)}}return e.jsxs("div",{className:"flex flex-col overflow-y-auto z-999 md:flex-row md:justify-center pt-10 bg-(--darker-bg-color) gap-5 fixed inset-0 w-full",children:[e.jsxs("form",{onSubmit:y,className:"flex relative min-w-[300px] overflow-y-auto pt-15 border border-(--border-color) h-fit bg-(--bg-color) flex-col gap-4 p-5",children:[e.jsx("button",{className:"absolute top-4 right-4 cursor-pointer hover:brightness-110 transition",onClick:()=>s(!1),children:e.jsx("img",{src:T,width:25,height:25})}),e.jsx("input",{type:"text",value:o,onChange:x=>n(x.target.value),placeholder:"العنوان",className:"p-2 rounded border border-(--border-color)",disabled:c}),e.jsxs("select",{value:p,className:"p-2 rounded border border-(--border-color)",onChange:x=>d(x.target.value),children:[e.jsx("option",{className:"bg-(--darker-bg-color)",value:"rtl",children:"عربي"}),e.jsx("option",{className:"bg-(--darker-bg-color)",value:"ltr",children:"انجلش"})]}),e.jsx("textarea",{dir:p,value:l,onChange:x=>u(x.target.value),placeholder:"المحتوى",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:c}),e.jsx("textarea",{dir:"ltr",value:h&&h.length>0?h.join(", "):"",onChange:x=>g(x.target.value.split(", ").map(N=>N)),placeholder:"Images (comma separated)",className:"p-2 rounded border border-(--border-color)",rows:5,disabled:c}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>w(!i),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${i?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${i?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:i?"Special":"Normal"})]}),e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer select-none",onClick:()=>v(!f),children:[e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors duration-300 ${f?"bg-(--accent-color)":"bg-gray-400/50"} relative`,children:e.jsx("span",{className:`block w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300 absolute top-0.5 ${f?"left-5":"left-0.5"}`})}),e.jsx("span",{className:"font-semibold text-sm",children:f?"Secret":"Normal"})]}),e.jsx("button",{type:"submit",className:`bg-(--accent-color) font-bold p-2 rounded hover:brightness-95 text-black cursor-pointer transition ${c?"opacity-50 cursor-not-allowed":""}`,disabled:c,children:c?"جار الإنشاء..":"أنشئ المنشور"})]}),e.jsx(C,{title:o,body:l,storyid:t,dir:p,images:h||[],type:b||"",special:i,secret:f,isCreating:!0,handleDeletePost:()=>{}})]})}const te=async(t,r)=>{const s=new Date().toLocaleTimeString(),o=new Date().toLocaleDateString(),n=navigator.platform+"";await fetch(`${S}/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitedAt:`${s} - ${o}`,os:n,url:r,username:t})})};function se(){const{type:t,count:r}=O(),{setType:s}=k(),{isAdmin:o,user:n}=P(),[l,u]=a.useState(!1);function h(d){i(c=>c===null?[d]:[d,...c])}a.useEffect(()=>{if(!o&&t){async function d(){await te(n?.username??"guest - ",t&&r?`${t} - ${r}`:"Home")}d()}},[t,r]),a.useEffect(()=>{t&&s(t)},[t,s]);const[g,i]=a.useState(null),[w,f]=a.useState(!0),[v,p]=a.useState("");return a.useEffect(()=>{async function d(){try{f(!0),i(null);const c=await fetch(`${S}/posts?type=${t}&count=${r}`,{method:"GET",credentials:"include"});if(c.ok){const m=await c.json();i(m),f(!1),p("")}else f(!1),p("Something went wrong."),i(null)}catch{i(null),f(!1),p("Server Error")}}d()},[r]),A("/mohsaid99/favicons/"+t+".svg"),w?e.jsx("div",{className:"flex flex-1 h-dvh items-center justify-center",children:e.jsx("div",{className:"animate-spin w-7 h-7",children:e.jsx("img",{src:B,alt:"spinning animation",width:28})})}):v?e.jsxs("div",{className:"flex h-screen items-center justify-center",children:["Error: ",v]}):g&&g.length>0?e.jsxs("div",{className:"flex flex-col md:pr-16 min-h-screen items-center justify-center py-25",children:[o&&e.jsx("button",{className:"bg-(--accent-color) rounded-full flex items-center justify-center w-[60px] h-[60px]",onClick:()=>u(!l),children:l?null:e.jsx("img",{src:z,width:30})}),l&&o&&e.jsx(ee,{setShowCreatePost:u,handleCreatePost:h,storyid:g[0].storyid}),g.map(d=>e.jsx(C,{storyid:d?.storyid??0,id:d?.id??0,title:d.title??"",time:d.iat??"",images:d?.images??[],body:d.body??"",dir:d.dir,type:d.type,special:d.special??!1,secret:d.secret??!1,handleEditPost:c=>i(m=>m&&m.map(b=>b.id===c.id?c:b)),handleDeletePost:c=>i(g.filter(m=>m.id!==c))},d.id))]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"No content available."})}export{se as default};
